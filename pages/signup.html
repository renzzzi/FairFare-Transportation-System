<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fair Fare - Sign Up / Verify</title> <!-- Updated Title -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="../css/headfoot.css">
    <link rel="stylesheet" href="../css/signup.css">

</head>
<body > <!-- Removed inline style -->
    <header class="sticky-top bg-white bg-opacity-75 div-blur shadow-sm">
        <!-- Header Content (Copy from previous page) -->
        <nav class="navbar navbar-expand-md nav-pad">
          <div class="container d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <img src="../images/logos/logo-color.png" alt="Logo" style="width: 50px; height: 50px;" class="me-2">
              <h1 class="mb-0 fs-2 d-none fw-bold f-primary d-md-block">FAIR FARE</h1>
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
              aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarContent">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link px-3 py-4 rounded" href="#">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-3 py-4 rounded" href="#">About</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-3 py-4 rounded" href="#">Contact</a>
                </li>
                <!-- Change Log Out to Log In/Sign Up if needed -->
                <li class="nav-item">
                    <a class="nav-link px-3 py-4 rounded" href="login.html">Log In</a>
                </li>
                 <li class="nav-item">
                    <a class="nav-link px-3 py-4 rounded active" href="signup.html">Sign Up</a> <!-- Current page -->
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>

      <main class="main-content d-flex align-items-center"> <!-- Use flex to help center vertically if needed -->
        <div class="container">

            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5"> <!-- Adjusted column width -->

                    <!-- ===================================== -->
                    <!-- == SIGN UP FORM CARD (Step 1) ===== -->
                    <!-- ===================================== -->
                    <div id="signup-card" class="card shadow-sm">
                        <div class="card-body p-4 p-md-5"> <!-- More padding -->
                            <h2 class="text-center mb-4 fs-3 fw-bold f-color">Create Your FairFare Account</h2>
                            <form id="signup-form" novalidate> <!-- Add novalidate to prevent browser default validation tooltips -->
                                <!-- First Name and Last Name -->
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="firstName" class="form-label">First Name *</label>
                                        <input type="text" class="form-control" id="firstName" required>
                                        <div class="invalid-feedback">Please enter your first name.</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="lastName" class="form-label">Last Name *</label>
                                        <input type="text" class="form-control" id="lastName" required>
                                         <div class="invalid-feedback">Please enter your last name.</div>
                                    </div>
                                </div>

                                <!-- Birthdate -->
                                <div class="mb-3">
                                    <label for="birthdate" class="form-label">Birthdate *</label>
                                    <input type="date" class="form-control" id="birthdate" required max="2010-12-31"> <!-- Add max date if needed -->
                                    <div class="invalid-feedback">Please enter your date of birth.</div>
                                </div>

                                <!-- Email -->
                                <div class="mb-3">
                                    <label for="email" class="form-label">Email Address *</label>
                                    <input type="email" class="form-control" id="email" placeholder="you@example.com" required>
                                     <div class="invalid-feedback">Please enter a valid email address.</div>
                                </div>

                                <!-- Phone Number -->
                                <div class="mb-3">
                                    <label class="form-label mb-1">Phone Number *</label>
                                     <div class="row g-2"> <!-- Use g-2 for small gap -->
                                         <div class="col-4 col-md-3">
                                              <label for="countryCode" class="form-label visually-hidden">Country code *</label>
                                              <select class="form-select" id="countryCode" required>
                                                  <option selected>+63</option>
                                                  {/* Add other codes if necessary */}
                                              </select>
                                         </div>
                                         <div class="col-8 col-md-9">
                                            <label for="phoneNumber" class="form-label visually-hidden">Phone number *</label>
                                            <input type="tel" class="form-control" id="phoneNumber" placeholder="9xxxxxxxxx" required pattern="[9][0-9]{9}"> <!-- Start with 9, 10 digits total -->
                                            <small class="form-text text-muted">Ex: 9171234567</small>
                                            <div class="invalid-feedback">Please enter a valid 10-digit phone number starting with 9.</div>
                                        </div>
                                     </div>
                                </div>

                                <!-- Password -->
                                <div class="mb-3">
                                    <label for="password" class="form-label">Password *</label>
                                    <input type="password" class="form-control" id="password" required aria-describedby="passwordHelp" minlength="8">
                                    <div id="passwordHelp" class="form-text" style="font-size: 0.8rem;">Must be at least 8 characters long.</div>
                                     <div class="invalid-feedback">Please enter a password (min. 8 characters).</div>
                                </div>

                                <!-- Confirm Password -->
                                <div class="mb-3">
                                    <label for="confirmPassword" class="form-label">Confirm Password *</label>
                                    <input type="password" class="form-control" id="confirmPassword" required>
                                    <div id="confirmPasswordError" class="invalid-feedback" style="font-size: 0.8rem;">Passwords do not match.</div>
                                </div>

                                <!-- Submit Button -->
                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary btn-lg">Continue to Verification</button>
                                </div>
                            </form>

                             <p class="text-center mt-4 mb-0">
                                 Already have an account? <a href="login.html" class="text-primary fw-medium">Log In</a>
                             </p>

                        </div> <!-- End card-body -->
                    </div> <!-- End signup-card -->


                    <!-- ===================================== -->
                    <!-- VERIFICATION CHOICE CARD (Step 2) -->
                    <!-- ===================================== -->
                    <div id="verification-card" class="card shadow-sm" style="display: none;">
                        <div class="card-body p-4 p-md-5">
                            <h2 class="text-center mb-2 fs-3 fw-bold f-color">Verify Your Account</h2>
                            <p class="text-center text-muted mb-4">Choose how to receive your verification code.</p>

                            <form id="verification-choice-form">
                                <!-- Email Option -->
                                <div class="form-check verification-option">
                                    <input class="form-check-input" type="radio" name="verificationMethod" id="verifyEmail" value="email" required checked>
                                    <label class="form-check-label" for="verifyEmail">
                                        <span>
                                            <i class="fas fa-envelope me-2 text-primary"></i> Email
                                        </span>
                                        <span id="display-email" class="contact-info"></span> <!-- Email shown here -->
                                    </label>
                                </div>

                                <!-- Phone Option -->
                                <div class="form-check verification-option">
                                    <input class="form-check-input" type="radio" name="verificationMethod" id="verifyPhone" value="phone" required>
                                    <label class="form-check-label" for="verifyPhone">
                                         <span>
                                             <i class="fas fa-mobile-alt me-2 text-primary"></i> Phone
                                         </span>
                                        <span id="display-phone" class="contact-info"></span> <!-- Phone shown here -->
                                    </label>
                                </div>

                                <!-- Send Code Button -->
                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary btn-lg">Send Verification Code</button>
                                </div>
                            </form>

                             <p class="text-center mt-4 mb-0">
                                 <a href="#" id="change-details-link" class="text-secondary fw-medium small"><i class="fas fa-chevron-left me-1"></i> Change Email/Phone</a>
                             </p>
                        </div>
                    </div> <!-- End verification-card -->

                    <!-- Code Entry Card would go here (Step 3) -->

                </div> <!-- End col -->
            </div> <!-- End row -->

        </div> <!-- End Container -->
      </main>

      <footer class="footer mt-auto"> <!-- Add mt-auto to push footer down -->
        <!-- Footer Content (Copy from previous page) -->
        <div class="footer-inside">
          <div class="footer-left">
            <img src="../images/logos/logo-white.png" alt="FairFare logo" class="footer-logo" height="100" width="100">
            <h4 class="fw-bold">FAIR FARE</h4>
            <p>Follow us on:</p>
            <div class="social-icons">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px" class="social-icon" fill="currentColor"><path d="M12,2C6.477,2,2,6.477,2,12c0,5.013,3.693,9.153,8.505,9.876V14.65H8.031v-2.629h2.474v-1.749 c0-2.896,1.411-4.167,3.818-4.167c1.153,0,1.762,0.085,2.051,0.124v2.294h-1.642c-1.022,0-1.379,0.969-1.379,2.061v1.437h2.995 l-0.406,2.629h-2.588v7.247C18.235,21.236,22,17.062,22,12C22,6.477,17.523,2,12,2z" /></svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px" class="social-icon" fill="currentColor"><path d="M 8 3 C 5.239 3 3 5.239 3 8 L 3 16 C 3 18.761 5.239 21 8 21 L 16 21 C 18.761 21 21 18.761 21 16 L 21 8 C 21 5.239 18.761 3 16 3 L 8 3 z M 18 5 C 18.552 5 19 5.448 19 6 C 19 6.552 18.552 7 18 7 C 17.448 7 17 6.552 17 6 C 17 5.448 17.448 5 18 5 z M 12 7 C 14.761 7 17 9.239 17 12 C 17 14.761 14.761 17 12 17 C 9.239 17 7 14.761 7 12 C 7 9.239 9.239 7 12 7 z M 12 9 A 3 3 0 0 0 9 12 A 3 3 0 0 0 12 15 A 3 3 0 0 0 15 12 A 3 3 0 0 0 12 9 z" /></svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="24px" height="24px" class="social-icon" fill="currentColor"><path d="M 11 4 C 7.134 4 4 7.134 4 11 L 4 39 C 4 42.866 7.134 46 11 46 L 39 46 C 42.866 46 46 42.866 46 39 L 46 11 C 46 7.134 42.866 4 39 4 L 11 4 z M 13.085938 13 L 21.023438 13 L 26.660156 21.009766 L 33.5 13 L 36 13 L 27.789062 22.613281 L 37.914062 37 L 29.978516 37 L 23.4375 27.707031 L 15.5 37 L 13 37 L 22.308594 26.103516 L 13.085938 13 z M 16.914062 15 L 31.021484 35 L 34.085938 35 L 19.978516 15 L 16.914062 15 z" /></svg>
            </div>
          </div>
          <div class="footer-form">
            <h4 class="fw-bold">Share something about us!</h4>
            <p>You can send a direct message to us here.</p>
            <form class="form-inputs">
              <div><input class="inputs mess-in" type="text" placeholder="Message"></div>
              <div><input class="inputs email-in" type="email" placeholder="Email"></div>
              <div><button class="submit-btn" type="submit">Send</button></div>
            </form>
          </div>
          <div class="quick-links">
            <h4 class="fw-bold">Quick Links</h4>
            <ul class="link-list"> <li>Log In</li> <li>Search Bus Terminals</li> <li>Help Centre</li> <li>Available Trips</li> </ul>
          </div>
          <div class="accounts">
            <h4 class="fw-bold">Accounts</h4>
            <ul class="link-list"> <li>Passenger</li> <li>Bus Driver / Conductor</li> <li>Bus Company</li> <li>Terminal Control</li> </ul>
          </div>
        </div>
      </footer>
      <footer class="bg-dark text-white py-2">
        <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
          <p class="mb-1 mb-md-0 small">Terms and Policies • Privacy Notice</p>
          <p class="mb-0 small">© Fair Fare 2025–2025</p>
        </div>
      </footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Form Elements
        const signupCard = document.getElementById('signup-card');
        const verificationCard = document.getElementById('verification-card');
        // const codeEntryCard = document.getElementById('code-entry-card'); // For future step

        const signupForm = document.getElementById('signup-form');
        const verificationChoiceForm = document.getElementById('verification-choice-form');

        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const confirmPasswordError = document.getElementById('confirmPasswordError');

        const displayEmail = document.getElementById('display-email');
        const displayPhone = document.getElementById('display-phone');
        const changeDetailsLink = document.getElementById('change-details-link');

        // --- Password Confirmation Validation ---
        const validatePasswordConfirmation = () => {
             // Clear previous custom validity first
            confirmPasswordInput.setCustomValidity("");
            confirmPasswordError.style.display = 'none'; // Hide custom message initially
            confirmPasswordInput.classList.remove('is-invalid'); // Remove explicit invalid class

            if (passwordInput.value && confirmPasswordInput.value && passwordInput.value !== confirmPasswordInput.value) {
                confirmPasswordInput.setCustomValidity("Passwords do not match."); // Set error for JS validation check
                confirmPasswordError.style.display = 'block'; // Show the custom error message div
                // Optionally add is-invalid class again if needed, but setCustomValidity often suffices
                 confirmPasswordInput.classList.add('is-invalid');
            }
        };

        passwordInput.addEventListener('input', validatePasswordConfirmation);
        confirmPasswordInput.addEventListener('input', validatePasswordConfirmation);

        // --- Step 1: Handle Signup Form Submission ---
        signupForm.addEventListener('submit', (event) => {
            event.preventDefault(); // Stop default submission
            event.stopPropagation();

            // Manually check password confirmation again on submit
            validatePasswordConfirmation();

            // Check overall form validity using Bootstrap's method
            if (!signupForm.checkValidity()) {
                console.log('Signup form is invalid.');
                signupForm.classList.add('was-validated'); // Show Bootstrap validation feedback
            } else {
                console.log('Signup form is valid. Proceeding to verification choice.');
                signupForm.classList.remove('was-validated'); // Clear validation states

                // ** TODO: Send provisional data to backend here (optional) **
                // fetch('/api/signup/provisional', { method: 'POST', body: new FormData(signupForm) }) ...

                // Get email and phone to display in next step
                const enteredEmail = document.getElementById('email').value;
                const enteredPhone = document.getElementById('countryCode').value + document.getElementById('phoneNumber').value;
                displayEmail.textContent = enteredEmail;
                displayPhone.textContent = enteredPhone;

                // Hide signup card, show verification card
                signupCard.style.display = 'none';
                verificationCard.style.display = 'block';
                window.scrollTo(0, 0); // Scroll to top
            }
        });

         // --- Step 2: Handle Verification Choice Form Submission ---
         verificationChoiceForm.addEventListener('submit', (event) => {
             event.preventDefault();
             event.stopPropagation();

             const selectedMethod = verificationChoiceForm.querySelector('input[name="verificationMethod"]:checked').value;
             const submitButton = verificationChoiceForm.querySelector('button[type="submit"]');

             console.log(`Verification method chosen: ${selectedMethod}`);
             submitButton.disabled = true;
             submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Sending Code...';


             // ** TODO: Send request to backend to initiate code sending **
             // const contact = (selectedMethod === 'email') ? displayEmail.textContent : displayPhone.textContent;
             // fetch('/api/signup/send-code', { method: 'POST', body: JSON.stringify({ method: selectedMethod, contact: contact })})
             // .then(response => response.json())
             // .then(data => {
             //      if(data.success) {
                          console.log("Simulating code sent via " + selectedMethod);
                           // Hide verification choice card, show code entry card (Future Step)
                           // verificationCard.style.display = 'none';
                           // codeEntryCard.style.display = 'block';
                           // window.scrollTo(0, 0);
                           alert(`Verification code sent via ${selectedMethod}! (Next step: Enter code - not implemented yet)`);
                           // For now, just re-enable button after simulation
                            setTimeout(() => {
                                submitButton.disabled = false;
                                submitButton.innerHTML = 'Send Verification Code';
                             }, 1500);
             //      } else { // Handle backend error }
             // })
             // .catch(error => { // Handle network error })
             // .finally(() => { // Re-enable button if needed });

              // --- Simulation for now ---
               setTimeout(() => {
                   alert(`Verification code sent via ${selectedMethod}! (Next step: Enter code - not implemented yet)`);
                   submitButton.disabled = false;
                   submitButton.innerHTML = 'Send Verification Code';
               }, 1500);
               // --- End Simulation ---
         });

         // --- Handle "Change Details" Link ---
         changeDetailsLink.addEventListener('click', (event) => {
             event.preventDefault();
             console.log('Changing details...');
             // Hide verification card, show signup card again
             verificationCard.style.display = 'none';
             signupCard.style.display = 'block';
             signupForm.classList.remove('was-validated'); // Clear validation state on signup form
             window.scrollTo(0, 0); // Scroll to top
         });

    });
</script>

</body>
</html>