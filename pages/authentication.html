<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fair Fare - Verify Account</title> <!-- Updated Title -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="../css/headfoot.css"> <!-- Adjust path if needed -->
    <style>
        /* --- Basic Theme Styles (Copy from previous signup page) --- */
        :root {
            --bs-primary: #00cde1;
            --bs-secondary: #E18702;
            --bs-primary-rgb: 0, 205, 225;
            --bs-danger: #dc3545;
            --bs-link-color: var(--bs-primary);
             --bs-link-hover-color: color-mix(in srgb, var(--bs-primary) 85%, black);
        }

        .f-color {
          color: var(--bs-primary);
        }

        .btn-primary {
            --bs-btn-bg: var(--bs-primary);
            --bs-btn-border-color: var(--bs-primary);
            --bs-btn-hover-bg: color-mix(in srgb, var(--bs-primary) 85%, black);
            --bs-btn-hover-border-color: color-mix(in srgb, var(--bs-primary) 80%, black);
            --bs-btn-active-bg: color-mix(in srgb, var(--bs-primary) 80%, black);
            --bs-btn-active-border-color: color-mix(in srgb, var(--bs-primary) 75%, black);
            --bs-btn-focus-shadow-rgb: var(--bs-primary-rgb);
             color: #fff;
        }
         .btn-primary:hover{
             color:#fff;
         }

        body {
            font-family: Montserrat, sans-serif;
            background-color: #f8f9fa; /* Light background for contrast */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .main-content {
            flex-grow: 1; /* Allows main content to fill space */
            padding-top: 3rem; /* More space below header */
            padding-bottom: 4rem;
        }
        .card {
            border-radius: 0.5rem;
            border: 1px solid #dee2e6;
            margin-bottom: 1.5rem;
        }
        .form-label {
            font-weight: 500;
            font-size: 0.875rem;
            color: #495057;
        }
        .form-control, .form-select {
            font-size: 0.95rem;
        }
        .text-primary {
             color: var(--bs-primary) !important;
        }
        /* --- Styles for Code Input --- */
        #verificationCode {
            text-align: center;
            font-size: 1.5rem; /* Larger font for code */
            letter-spacing: 0.5em; /* Space out digits */
            padding-left: calc(0.75rem + 0.5em); /* Adjust padding due to letter-spacing */
        }
        /* --- Styles for Helper Links --- */
        .helper-links {
             font-size: 0.9rem;
             margin-top: 1.5rem;
             text-align: center;
        }
        .helper-links a, .helper-links button {
             color: var(--bs-secondary); /* Using secondary color for links */
             text-decoration: none;
             font-weight: 500;
        }
         .helper-links a:hover, .helper-links button:hover {
             color: color-mix(in srgb, var(--bs-secondary) 85%, black);
             text-decoration: underline;
         }
         /* Style for disabled resend button */
         #resend-code-button:disabled {
            opacity: 0.65;
            pointer-events: none;
            text-decoration: none;
            color: #6c757d; /* Muted color when disabled */
         }
         /* Style for button link */
         .btn-link-secondary {
            color: var(--bs-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 0;
            vertical-align: baseline;
         }
         .btn-link-secondary:hover {
             color: color-mix(in srgb, var(--bs-secondary) 85%, black);
             text-decoration: underline;
         }
        /* --- End Specific Styles --- */

    </style>
</head>
<body >
    <header class="sticky-top bg-white bg-opacity-75 div-blur shadow-sm">
        <!-- Header Content (Copy from previous page) -->
        <nav class="navbar navbar-expand-md nav-pad">
          <div class="container d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
              <img src="../images/logos/logo-color.png" alt="Logo" style="width: 50px; height: 50px;" class="me-2">
              <h1 class="mb-0 fs-2 d-none fw-bold f-primary d-md-block">FAIR FARE</h1>
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
              aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarContent">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link px-3 py-4 rounded" href="#">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-3 py-4 rounded" href="#">About</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link px-3 py-4 rounded" href="#">Contact</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link px-3 py-4 rounded" href="login.html">Log In</a>
                </li>
                 <li class="nav-item">
                    <a class="nav-link px-3 py-4 rounded active" href="signup.html">Sign Up</a> <!-- Keep signup active during flow -->
                </li>
              </ul>
            </div>
          </div>
        </nav>
      </header>

      <main class="main-content d-flex align-items-center">
        <div class="container">

            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6 col-xl-5"> <!-- Consistent column width -->

                    <!-- ===================================== -->
                    <!-- == CODE ENTRY CARD (Step 3) ======= -->
                    <!-- ===================================== -->
                    <div id="code-entry-card" class="card shadow-sm">
                        <div class="card-body p-4 p-md-5">
                            <h2 class="text-center mb-2 fs-3 fw-bold f-color">Enter Verification Code</h2>
                            <p class="text-center text-muted mb-4">
                                A 6-digit code was sent to <br><strong id="verification-target" class="text-primary">juandelacruz@gmail.com</strong>.
                            </p>

                            <form id="code-entry-form" novalidate>
                                <!-- Verification Code Input -->
                                <div class="mb-3">
                                    <label for="verificationCode" class="form-label visually-hidden">Verification Code *</label>
                                    <input type="text" class="form-control" id="verificationCode" required
                                           inputmode="numeric" pattern="[0-9]{6}" maxlength="6" autocomplete="one-time-code"
                                           placeholder="------">
                                    <div id="code-error-message" class="invalid-feedback text-center mt-2">Please enter the 6-digit code.</div>
                                </div>

                                <!-- Verify Button -->
                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary btn-lg">Verify Account</button>
                                </div>
                            </form>

                             <!-- Helper Links -->
                             <div class="helper-links">
                                 Didn't receive the code?
                                 <button type="button" id="resend-code-button" class="btn btn-link-secondary p-0">
                                     Resend Code
                                 </button>
                                 <span id="resend-timer" class="text-muted"></span>
                                 <br>
                                 <a href="#" id="go-back-link" class="mt-2 d-inline-block"><i class="fas fa-chevron-left me-1"></i> Go Back</a>
                             </div>

                        </div> <!-- End card-body -->
                    </div> <!-- End code-entry-card -->

                </div> <!-- End col -->
            </div> <!-- End row -->

        </div> <!-- End Container -->
      </main>

      <!-- ===================================== -->
<!-- == SUCCESS VERIFICATION MODAL ==== -->
<!-- ===================================== -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false"> <!-- Prevent closing on backdrop click/esc -->
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-4">
                <i class="fas fa-check-circle fa-4x mb-3 text-success"></i> <!-- Success Icon -->
                <h5 class="modal-title mb-3" id="successModalLabel">Account Verified!</h5>
                <p>Your account has been successfully verified. You can now explore trips.</p>
                <button type="button" id="searchTripButton" class="btn btn-primary mt-3">
                    <i class="fas fa-search me-2"></i>Search Trips Now
                </button>
            </div>
        </div>
    </div>
</div>
<!-- ===================================== -->
<!-- == END SUCCESS VERIFICATION MODAL == -->

      <footer class="footer mt-auto">
        <!-- Footer Content (Copy from previous page) -->
        <div class="footer-inside">
          <div class="footer-left">
            <img src="../images/logos/logo-white.png" alt="FairFare logo" class="footer-logo" height="100" width="100">
            <h4 class="fw-bold">FAIR FARE</h4>
            <p>Follow us on:</p>
            <div class="social-icons">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px" class="social-icon" fill="currentColor"><path d="M12,2C6.477,2,2,6.477,2,12c0,5.013,3.693,9.153,8.505,9.876V14.65H8.031v-2.629h2.474v-1.749 c0-2.896,1.411-4.167,3.818-4.167c1.153,0,1.762,0.085,2.051,0.124v2.294h-1.642c-1.022,0-1.379,0.969-1.379,2.061v1.437h2.995 l-0.406,2.629h-2.588v7.247C18.235,21.236,22,17.062,22,12C22,6.477,17.523,2,12,2z" /></svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px" class="social-icon" fill="currentColor"><path d="M 8 3 C 5.239 3 3 5.239 3 8 L 3 16 C 3 18.761 5.239 21 8 21 L 16 21 C 18.761 21 21 18.761 21 16 L 21 8 C 21 5.239 18.761 3 16 3 L 8 3 z M 18 5 C 18.552 5 19 5.448 19 6 C 19 6.552 18.552 7 18 7 C 17.448 7 17 6.552 17 6 C 17 5.448 17.448 5 18 5 z M 12 7 C 14.761 7 17 9.239 17 12 C 17 14.761 14.761 17 12 17 C 9.239 17 7 14.761 7 12 C 7 9.239 9.239 7 12 7 z M 12 9 A 3 3 0 0 0 9 12 A 3 3 0 0 0 12 15 A 3 3 0 0 0 15 12 A 3 3 0 0 0 12 9 z" /></svg>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="24px" height="24px" class="social-icon" fill="currentColor"><path d="M 11 4 C 7.134 4 4 7.134 4 11 L 4 39 C 4 42.866 7.134 46 11 46 L 39 46 C 42.866 46 46 42.866 46 39 L 46 11 C 46 7.134 42.866 4 39 4 L 11 4 z M 13.085938 13 L 21.023438 13 L 26.660156 21.009766 L 33.5 13 L 36 13 L 27.789062 22.613281 L 37.914062 37 L 29.978516 37 L 23.4375 27.707031 L 15.5 37 L 13 37 L 22.308594 26.103516 L 13.085938 13 z M 16.914062 15 L 31.021484 35 L 34.085938 35 L 19.978516 15 L 16.914062 15 z" /></svg>
            </div>
          </div>
          <div class="footer-form">
            <h4 class="fw-bold">Share something about us!</h4>
            <p>You can send a direct message to us here.</p>
            <form class="form-inputs">
              <div><input class="inputs mess-in" type="text" placeholder="Message"></div>
              <div><input class="inputs email-in" type="email" placeholder="Email"></div>
              <div><button class="submit-btn" type="submit">Send</button></div>
            </form>
          </div>
          <div class="quick-links">
            <h4 class="fw-bold">Quick Links</h4>
            <ul class="link-list"> <li>Log In</li> <li>Search Bus Terminals</li> <li>Help Centre</li> <li>Available Trips</li> </ul>
          </div>
          <div class="accounts">
            <h4 class="fw-bold">Accounts</h4>
            <ul class="link-list"> <li>Passenger</li> <li>Bus Driver / Conductor</li> <li>Bus Company</li> <li>Terminal Control</li> </ul>
          </div>
        </div>
      </footer>
      <footer class="bg-dark text-white py-2">
        <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
          <p class="mb-1 mb-md-0 small">Terms and Policies • Privacy Notice</p>
          <p class="mb-0 small">© Fair Fare 2025–2025</p>
        </div>
      </footer>

      <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Elements ---
            const codeEntryForm = document.getElementById('code-entry-form');
            const verificationCodeInput = document.getElementById('verificationCode');
            const verificationTargetSpan = document.getElementById('verification-target');
            const resendButton = document.getElementById('resend-code-button');
            const resendTimerSpan = document.getElementById('resend-timer');
            const goBackButton = document.getElementById('go-back-link');
            const codeErrorMessage = document.getElementById('code-error-message');
    
            // --- Modal Elements ---
            const successModalElement = document.getElementById('successModal');
            const successModal = new bootstrap.Modal(successModalElement); // Initialize Bootstrap Modal
            const searchTripButton = document.getElementById('searchTripButton');
    
            // --- Resend Timer Variables ---
            const RESEND_COOLDOWN_SECONDS = 60; // Cooldown period in seconds
            let timerInterval = null;
            let secondsRemaining = 0;
    
            // --- Get Data from Previous Step (Example using localStorage) ---
            const verificationMethod = localStorage.getItem('signupVerificationMethod') || 'email';
            const verificationContact = localStorage.getItem('signupVerificationContact') || '[Contact Info Missing]';
    
            // --- Update UI on Load ---
            if(verificationTargetSpan) verificationTargetSpan.textContent = verificationContact;
            if(resendButton) startResendTimer(); // Start timer if elements exist
    
            // --- Functions ---
            function startResendTimer() {
                if (!resendButton || !resendTimerSpan) return; // Defensive check
                clearInterval(timerInterval);
                secondsRemaining = RESEND_COOLDOWN_SECONDS;
                resendButton.disabled = true;
                resendTimerSpan.textContent = `(wait ${secondsRemaining}s)`;
                resendTimerSpan.style.display = 'inline';
    
                timerInterval = setInterval(() => {
                    secondsRemaining--;
                    resendTimerSpan.textContent = `(wait ${secondsRemaining}s)`;
                    if (secondsRemaining <= 0) {
                        stopResendTimer();
                    }
                }, 1000);
            }
    
            function stopResendTimer() {
                 if (!resendButton || !resendTimerSpan) return; // Defensive check
                clearInterval(timerInterval);
                resendTimerSpan.textContent = '';
                resendTimerSpan.style.display = 'none';
                resendButton.disabled = false;
            }
    
            function showCodeError(message) {
                 if (!verificationCodeInput || !codeErrorMessage) return; // Defensive check
                 verificationCodeInput.classList.add('is-invalid');
                 codeErrorMessage.textContent = message;
                 codeErrorMessage.style.display = 'block'; // Ensure it's visible
            }
    
             function clearCodeError() {
                 if (!verificationCodeInput || !codeErrorMessage) return; // Defensive check
                 verificationCodeInput.classList.remove('is-invalid');
                 codeErrorMessage.style.display = 'none'; // Hide it
             }
    
            // --- Event Listeners ---
    
            if(codeEntryForm) {
                codeEntryForm.addEventListener('submit', (event) => {
                    event.preventDefault();
                    event.stopPropagation();
                    clearCodeError(); // Clear previous errors
    
                    if (!codeEntryForm.checkValidity()) {
                        codeEntryForm.classList.add('was-validated');
                        if (verificationCodeInput.validity.valueMissing) {
                             showCodeError('Please enter the 6-digit code.');
                        } else if (verificationCodeInput.validity.patternMismatch) {
                             showCodeError('Code must be 6 digits.');
                        }
                    } else {
                        codeEntryForm.classList.remove('was-validated');
                        const enteredCode = verificationCodeInput.value;
                        const submitButton = codeEntryForm.querySelector('button[type="submit"]');
    
                        console.log(`Submitting code: ${enteredCode} for ${verificationContact}`);
                        if(submitButton) {
                            submitButton.disabled = true;
                            submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Verifying...';
                        }
    
    
                        // ** TODO: Send code and contact info to backend for verification **
                        // fetch('/api/signup/verify-code', { ... })
                        // .then(response => response.json())
                        // .then(data => {
                        //      if(data.success) {
                        //          console.log('Verification successful!');
                        //          // Clear stored signup data
                        //          localStorage.removeItem('signupVerificationMethod');
                        //          localStorage.removeItem('signupVerificationContact');
                        //          // **** SHOW SUCCESS MODAL INSTEAD OF REDIRECTING ****
                        //          successModal.show();
                        //          // Optionally reset the verify button state if user might close modal
                        //          // if(submitButton) {
                        //          //    submitButton.disabled = false;
                        //          //    submitButton.innerHTML = 'Verify Account';
                        //          // }
                        //      } else { ... handle failure ... }
                        // })
                        // .catch(error => { ... handle error ... });
    
    
                         // --- Simulation for now ---
                         setTimeout(() => {
                            if (enteredCode === "123456") { // Simulate correct code
                                 console.log('Verification successful! (Simulation)');
                                 // Clear stored signup data
                                 localStorage.removeItem('signupVerificationMethod');
                                 localStorage.removeItem('signupVerificationContact');
                                 // **** SHOW SUCCESS MODAL ****
                                 successModal.show();
                                  // Keep button disabled as next action is modal
                            } else { // Simulate incorrect code
                                 console.error('Verification failed (Simulation)');
                                 showCodeError('Invalid or expired code. Please try again.');
                                if(submitButton) {
                                     submitButton.disabled = false;
                                     submitButton.innerHTML = 'Verify Account';
                                 }
                                 if(verificationCodeInput) verificationCodeInput.value = ''; // Clear input on failure
                            }
                         }, 1000); // Reduced delay for simulation
                         // --- End Simulation ---
                    }
                });
            } // end if(codeEntryForm)
    
            if(resendButton) {
                resendButton.addEventListener('click', () => {
                     if (resendButton.disabled) return;
                    console.log(`Requesting resend code for ${verificationContact} via ${verificationMethod}`);
                    resendButton.disabled = true;
                    resendButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Sending...';
                    clearCodeError();
    
                     // ** TODO: Backend call to resend code **
    
                     // --- Simulation for now ---
                     setTimeout(() => {
                         console.log('Resend request successful (Simulation).');
                         alert('A new verification code has been sent (Simulation).');
                         resendButton.innerHTML = 'Resend Code';
                         startResendTimer();
                     }, 1000);
                     // --- End Simulation ---
                });
            } // end if(resendButton)
    
            if(goBackButton) {
                goBackButton.addEventListener('click', (event) => {
                    event.preventDefault();
                    console.log('Going back to previous step.');
                    window.history.back();
                });
            } // end if(goBackButton)
    
            if(verificationCodeInput) {
                verificationCodeInput.addEventListener('input', () => {
                    if (verificationCodeInput.classList.contains('is-invalid')) {
                         clearCodeError();
                         if(codeEntryForm) codeEntryForm.classList.remove('was-validated');
                    }
                });
            } // end if(verificationCodeInput)
    
            // --- Add Event Listener for Modal Button ---
            if (searchTripButton) {
                 searchTripButton.addEventListener('click', () => {
                     console.log('Navigating to client page...');
                     window.location.href = 'client.html'; // Redirect to client page
                 });
             }
    
        }); // End DOMContentLoaded
    </script>

</body>
</html>